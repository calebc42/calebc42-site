.handwritten-wrapper {
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  overflow: hidden;
  
  .handwritten-svg {
    width: 100%;
    height: auto;
    display: block;

    /* Hide Supernote binary data/embedded assets */
    image, use, defs > * { 
      display: none; 
    }

    .template-line {
      stroke: var(--border-color);
      stroke-width: 2;
      opacity: 0.5;
      transition: stroke 0.3s ease;
    }

    .ink-strokes path,
    .signature-strokes path {
      stroke: var(--text-primary);
      stroke-width: 6;
      stroke-linecap: round;
      stroke-linejoin: round;
      fill: none;
      transition: stroke-dashoffset 0.1s linear;
    }
  }

  .handwriting-toggle {
    position: absolute;
    inset: 10px auto auto 10px;
    z-index: 50;
    opacity: 0.4;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 6px;
    cursor: pointer;
    border-radius: var(--border-radius);
    transition: all 0.3s ease;
    
    &:hover {
      opacity: 1;
      background: var(--color-accent);
      color: var(--bg-primary);
    }

    .material-symbols-outlined {
      font-size: 20px;
    }
  }

  &.is-completed .ink-strokes path,
  &.is-completed .signature-strokes path {
    stroke-dashoffset: 0 !important;
    transition: stroke-dashoffset 0.5s ease-in-out !important;
  }
}

/* Mobile: Make SVG larger and allow horizontal scroll if needed */
@media (max-width: 768px) {
  .handwritten-layout .handwritten-main {
    padding: var(--spacing-md) 0; // Remove side padding
    overflow-x: auto; // Allow horizontal scroll
  }

  .handwritten-wrapper {
    max-width: none; // Remove max-width constraint
    width: 100vw; // Full viewport width
    margin: 0;
    
    .handwritten-svg {
      // Force SVG to be larger on mobile
      min-width: 600px; // Supernote aspect ratio preserved
      width: 140%; // 40% larger than viewport
      margin: 0 auto;
    }
  }
}

/* Tablet: Intermediate sizing */
@media (min-width: 769px) and (max-width: 1024px) {
  .handwritten-wrapper {
    max-width: 100%;
    
    .handwritten-svg {
      width: 95%;
      margin: 0 auto;
    }
  }
}

.margin-line {
  stroke: var(--error-color);
  stroke-width: 2;
  opacity: 0.3;
}

[data-theme="dark"] {
  .handwritten-wrapper {
    .template-line {
      stroke: rgba(250, 240, 220, 0.25);
      opacity: 0.5;
    }

    .ink-strokes path,
    .signature-strokes path {
      filter: drop-shadow(0 0 1.5px var(--accent-glow-color));
    }
  }
}

/* Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
  .handwritten-wrapper {
    .ink-strokes path,
    .signature-strokes path {
      stroke-dashoffset: 0 !important;
      transition: none !important;
    }
    
    .handwriting-toggle {
      display: none; // Hide toggle when animations disabled
    }
  }
}

.handwritten-multipage {
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: var(--spacing-xxl) auto;
  
  // Single toggle for entire document
  .handwriting-toggle {
    position: sticky;
    top: 10px;
    left: 10px;
    z-index: 100;
    opacity: 0.4;
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    padding: 6px;
    cursor: pointer;
    border-radius: var(--border-radius);
    transition: all 0.3s ease;
    margin-bottom: -40px; // Pull up so it overlays first page
    
    &:hover {
      opacity: 1;
      background: var(--color-accent);
      color: var(--bg-primary);
    }
  }
  
  .handwritten-page {
    position: relative;
    margin-bottom: var(--spacing-xl);
    
    // Page separator
    &:not(:last-child)::after {
      content: '';
      display: block;
      width: 60%;
      height: 2px;
      margin: var(--spacing-lg) auto;
      background: linear-gradient(
        to right,
        transparent,
        var(--border-color) 20%,
        var(--border-color) 80%,
        transparent
      );
      opacity: 0.3;
    }
    
    .page-number {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      opacity: 0.5;
      font-family: var(--font-mono);
    }
  }
}
